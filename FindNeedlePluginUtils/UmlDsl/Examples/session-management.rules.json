{
  "title": "Session Management Sequence",
  "participants": [
    { "id": "Stack", "displayName": "RDP Stack", "type": "participant" },
    { "id": "Termsrv", "displayName": "Terminal Services", "type": "participant" },
    { "id": "LSM", "displayName": "Local Session Manager", "type": "participant" },
    { "id": "Winlogon", "displayName": "Winlogon", "type": "participant" },
    { "id": "svchost", "displayName": "Service Host", "type": "participant" }
  ],
  "rules": [
    {
      "name": "WMsgMessageHandler",
      "match": "- WMsgMessageHandler: ",
      "unmatch": "dwMessage",
      "action": {
        "type": "message",
        "from": "LSM",
        "to": "Winlogon",
        "text": "{afterMatch}"
      }
    },
    {
      "name": "StateFn",
      "match": "StateFn:",
      "action": {
        "type": "message",
        "from": "LSM",
        "to": "Winlogon",
        "text": "{afterMatch}"
      }
    },
    {
      "name": "BeginSessionArbitration",
      "match": "Begin session arbitration:",
      "action": {
        "type": "message",
        "from": "LSM",
        "to": "LSM",
        "text": "Start session arbitration"
      }
    },
    {
      "name": "EndSessionArbitration",
      "match": "End session arbitration:",
      "action": {
        "type": "message",
        "from": "LSM",
        "to": "LSM",
        "text": "Stop session arbitration"
      }
    },
    {
      "name": "SessionLogonSucceeded",
      "match": "Remote Desktop Services: Session logon succeeded",
      "action": {
        "type": "message",
        "from": "LSM",
        "to": "LSM",
        "text": "User logged on"
      }
    },
    {
      "name": "SystemShutdown",
      "match": "Local multi-user session manager received system shutdown message",
      "action": {
        "type": "message",
        "from": "svchost",
        "to": "LSM",
        "text": "System shutting down"
      }
    },
    {
      "name": "ShellStarted",
      "match": "Remote Desktop Services: Shell start notification received",
      "action": {
        "type": "message",
        "from": "LSM",
        "to": "LSM",
        "text": "Shell started"
      }
    },
    {
      "name": "OOBERunning",
      "match": "Remote Desktop Services is not accepting logons because setup is running.",
      "action": {
        "type": "message",
        "from": "LSM",
        "to": "LSM",
        "text": "OOBE is running, no remote connections"
      }
    },
    {
      "name": "SessionLogoff",
      "match": "Remote Desktop Services: Session logoff succeeded:",
      "action": {
        "type": "message",
        "from": "LSM",
        "to": "LSM",
        "text": "Session logoff"
      }
    },
    {
      "name": "ConnectToTerminal",
      "match": "CTSSession::ConnectToTerminal on session ID ",
      "action": {
        "type": "message",
        "from": "LSM",
        "to": "LSM",
        "text": "Connect Terminal to Session ID {afterMatch:untilSpace}"
      }
    },
    {
      "name": "DisconnectSession",
      "match": "CTSSession::DisconnectSession on session ID ",
      "action": {
        "type": "message",
        "from": "LSM",
        "to": "LSM",
        "text": "Disconnect sessionID: {afterMatch:untilSpace}"
      }
    },
    {
      "name": "AssignSessionId",
      "match": "Assign session id ",
      "action": {
        "type": "message",
        "from": "LSM",
        "to": "LSM",
        "text": "Assign Terminal to Session ID {afterMatch:untilSpace}"
      }
    },
    {
      "name": "FastReconnect",
      "match": "msg=Fast reconnect - adding session, SessionId=",
      "action": {
        "type": "message",
        "from": "Termsrv",
        "to": "LSM",
        "text": "Fast reconnect to Session ID {afterMatch}"
      }
    },
    {
      "name": "LoggedOnStarted",
      "match": "msg=pNewTerminal->LoggedOnStarted() took this long, this->CommonData.GetSessionId()=",
      "action": {
        "type": "message",
        "from": "Termsrv",
        "to": "LSM",
        "text": "LoggedOnStarted finished to Session ID {afterMatch}"
      }
    },
    {
      "name": "ConnectNotify",
      "match": "msg=LSM sent us ConnectNotify, m_SessionId=",
      "action": {
        "type": "message",
        "from": "LSM",
        "to": "Termsrv",
        "text": "ConnectNotify Session ID {afterMatch}"
      }
    },
    {
      "name": "DisconnectNotify",
      "match": "msg=Trying to call DisconnectNotify, SessionId=",
      "action": {
        "type": "message",
        "from": "LSM",
        "to": "Termsrv",
        "text": "DisconnectNotify Session ID {afterMatch}"
      }
    },
    {
      "name": "StackReady",
      "match": "perf=Stack took this long to get ready, StackReadyTime=",
      "action": {
        "type": "message",
        "from": "Stack",
        "to": "Termsrv",
        "text": "Stack is ready for connection (took: {afterMatch:until:,} ms)"
      }
    },
    {
      "name": "FastReconnectTime",
      "match": "perf=Fast reconnect time to connect to session, ",
      "action": {
        "type": "message",
        "from": "Termsrv",
        "to": "Termsrv",
        "text": "Fast reconnect finished (took: {afterMatch:until:,} ms)"
      }
    },
    {
      "name": "NewConnection",
      "match": "Listener was notified of a new connection",
      "action": {
        "type": "message",
        "from": "Stack",
        "to": "Termsrv",
        "text": "New connection received"
      }
    },
    {
      "name": "BrokenConnection",
      "match": "Task started=Broken Connection, Function=CConnectionEx::CRDPCallback::BrokenConnection",
      "action": {
        "type": "message",
        "from": "Stack",
        "to": "Termsrv",
        "text": "Connection was broken"
      }
    }
  ]
}
